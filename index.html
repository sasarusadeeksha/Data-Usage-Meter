<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Digital Clocks</title>
  <style>
    :root{
      --bg:#0f1217;
      --card:#171b22;
      --text:#e8ecf1;
      --muted:#9aa4b2;
      --accent:#00e0ff;
      --radius:12px;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, "Helvetica Neue", Arial;
    }
    body { margin:0; background:transparent; color:var(--text); }
    .world-clocks {
      max-width:900px;
      margin:0 auto;
      padding:18px;
      display:block;
    }
    .wc-header {
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .wc-title { font-size:20px; font-weight:700; margin:0; }
    .wc-controls { margin-left:auto; display:flex; gap:8px; align-items:center; }
    .wc-controls input {
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #242c3b;
      background:#0b0f15;
      color:var(--text);
      min-width:190px;
    }
    .btn {
      padding:8px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      background:linear-gradient(90deg,var(--accent),#0099ff);
      color:#061018;
      font-weight:700;
    }
    .wc-grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:12px;
    }
    .clock {
      background:var(--card);
      border:1px solid #242c3b;
      border-radius:var(--radius);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .tz-name { font-weight:700; color:var(--text); display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .time {
      font-variant-numeric: tabular-nums;
      font-size:28px;
      font-weight:800;
      letter-spacing:0.02em;
      color:var(--accent);
    }
    .date { color:var(--muted); font-size:13px; }
    .small {
      font-size:12px;
      color:var(--muted);
    }
    .remove {
      background:transparent;
      border:1px solid #2a3242;
      color:var(--muted);
      padding:4px 8px;
      border-radius:8px;
      cursor:pointer;
    }
    .error { color: #ff8b8b; font-size:13px; margin-left:8px; }
    @media (max-width:520px){
      .time { font-size:22px; }
    }
  </style>
</head>
<body>
  <section class="world-clocks" aria-labelledby="wc-title">
    <div class="wc-header">
      <h2 id="wc-title" class="wc-title">World Clocks</h2>
      <div class="wc-controls" role="search" aria-label="Add timezone">
        <input id="tz-input" type="text" placeholder="Add timezone e.g. America/New_York" aria-label="Timezone name (IANA)"/>
        <button id="add-btn" class="btn" type="button">Add</button>
        <div id="tz-error" class="error" role="status" aria-live="polite"></div>
      </div>
    </div>

    <div id="wc-grid" class="wc-grid" aria-live="polite">
      <!-- clocks will be injected here -->
    </div>

    <p class="small" style="margin-top:12px;">
      Times update every second. Use IANA timezone names (e.g. "Europe/London", "Asia/Tokyo", "UTC").
    </p>
  </section>

  <script>
    (function () {
      // Default timezones to display
      const defaultZones = [
        { label: 'Local', timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC' },
        { label: 'UTC', timeZone: 'UTC' },
        { label: 'New York', timeZone: 'America/New_York' },
        { label: 'London', timeZone: 'Europe/London' },
        { label: 'Tokyo', timeZone: 'Asia/Tokyo' },
        { label: 'Sydney', timeZone: 'Australia/Sydney' }
      ];

      const grid = document.getElementById('wc-grid');
      const addBtn = document.getElementById('add-btn');
      const tzInput = document.getElementById('tz-input');
      const tzError = document.getElementById('tz-error');

      // maintain a Map of timeZone -> element
      const clocks = new Map();

      function createClockCard(zoneObj) {
        const { timeZone, label } = zoneObj;
        if (clocks.has(timeZone)) return; // skip duplicates

        const card = document.createElement('div');
        card.className = 'clock';
        card.dataset.timeZone = timeZone;

        const nameRow = document.createElement('div');
        nameRow.className = 'tz-name';

        const name = document.createElement('div');
        name.textContent = label || timeZone;

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove';
        removeBtn.type = 'button';
        removeBtn.title = `Remove ${timeZone}`;
        removeBtn.textContent = 'Remove';
        removeBtn.addEventListener('click', () => {
          clocks.delete(timeZone);
          card.remove();
        });

        nameRow.appendChild(name);
        nameRow.appendChild(removeBtn);

        const time = document.createElement('div');
        time.className = 'time';
        time.setAttribute('aria-live', 'polite');
        time.textContent = '--:--:--';

        const date = document.createElement('div');
        date.className = 'date';
        date.textContent = '';

        card.appendChild(nameRow);
        card.appendChild(time);
        card.appendChild(date);

        grid.appendChild(card);
        clocks.set(timeZone, { card, time, date, label });
      }

      function updateAllClocks() {
        const now = new Date();
        clocks.forEach((obj, tz) => {
          try {
            const timeStr = now.toLocaleTimeString(undefined, {
              hour: '2-digit', minute: '2-digit', second: '2-digit',
              hour12: false, timeZone: tz
            });
            const dateStr = now.toLocaleDateString(undefined, {
              year: 'numeric', month: 'short', day: 'numeric', timeZone: tz
            });
            obj.time.textContent = timeStr;
            obj.date.textContent = dateStr;
          } catch (e) {
            // Invalid timeZone (shouldn't happen after validation) -> show error
            obj.time.textContent = 'â€”';
            obj.date.textContent = 'Invalid timezone';
          }
        });
      }

      function isValidTimeZone(tz) {
        try {
          // Will throw RangeError if invalid timezone
          Intl.DateTimeFormat(undefined, { timeZone: tz }).format();
          return true;
        } catch (e) {
          return false;
        }
      }

      // Initialize default clocks
      defaultZones.forEach(z => createClockCard(z));
      updateAllClocks();
      // update every second, synced to the second boundary for smoother ticks
      setInterval(updateAllClocks, 1000);

      // Add new timezone via input
      addBtn.addEventListener('click', () => {
        const raw = tzInput.value.trim();
        if (!raw) {
          tzError.textContent = 'Enter a timezone (IANA name)';
          return;
        }
        tzError.textContent = '';
        if (!isValidTimeZone(raw)) {
          tzError.textContent = 'Invalid IANA timezone name';
          return;
        }
        createClockCard({ timeZone: raw, label: raw.replace('_', ' ') });
        tzInput.value = '';
        tzInput.focus();
      });

      // Enter key to add
      tzInput.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter') addBtn.click();
      });

      // Expose a small helper to add programmatically if embedding in larger app
      window.WorldClocks = { add: (tz, label) => {
        if (!tz || !isValidTimeZone(tz)) throw new Error('Invalid timezone');
        createClockCard({ timeZone: tz, label: label || tz });
      }};
    })();
  </script>
</body>
</html>
